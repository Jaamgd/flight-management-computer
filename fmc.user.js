// ==UserScript==
// @name FMC Extension for GEFS-Online
// @description This extension (by Ethan Shields) adds an FMC which controls other features included such as auto-climb, auto-descent, progress information, etc.
// @namespace GEFS-Plugins
// @match http://www.gefs-online.com/gefs.php*
// @match http://gefs-online.com/gefs.php*
// @run-at document-end
// @version 0.4.3.1505
// @grant none
// ==/UserScript==

/*
    Copyright (C) 2015 Ethan Shields, 2015 other contributors

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License along
    with this program; if not, please visit http://www.gnu.org/licenses/gpl-3.0.html.
*/

// Kudos to Harry Xue for cleaning and restructuring code
window.fmc={math:{toRadians:function(a){return a*Math.PI/180},toDegrees:function(a){return 180*a/Math.PI},earthRadiusNM:3440.06},waypoints:{input:"",route:[],nextWaypoint:"",makeFixesArray:function(){var a=[],t=$("#departureInput").val();t&&a.push(t),$(".waypoint td:first-child div > input").each(function(){a.push($(this).val())});var e=$("#arrivalInput").val();return e&&a.push(e),a},toFixesString:function(){return fmc.waypoints.makeFixesArray().join(" ")},toRouteString:function(){return JSON.stringify([$("#departureInput").val(),$("#arrivalInput").val(),$("#flightNumInput").val(),fmc.waypoints.route])}}},fmc.ui={externalDist:$("<div>").addClass("setup-section").css("padding-bottom","0px").append($("<div>").addClass("input-prepend input-append").css("margin-bottom","4px").append($("<span>").addClass("add-on").text("Dest"),$("<span>").addClass("add-on").css("background-color","white").css("width","53px").append($("<div>").attr("id","externaldist")))).appendTo("td.gefs-f-standard"),button:$("<button>").addClass("btn btn-success gefs-stopPropagation").attr("type","button").attr("data-toggle","modal").attr("data-target","#fmcModal").css("margin-left","1px").text("FMC ").append($("<i>").addClass("icon-list-alt")).appendTo("div.setup-section:nth-child(2)")},function(a){var t=setInterval(function(){window.ges&&ges.aircraft&&ges.aircraft.animationValue&&ges.aircraft.animationValue.altitude&&(clearInterval(t),a())},4)}(function(){function a(){var a=ges.aircraft.llaLocation[0]||0,t=ges.aircraft.llaLocation[1]||0,e=W[1]||0,n=W[2]||0,s=["--","--","--","--","--"],i=v(fmc.waypoints.nextWaypoint);i=10>i?Math.round(10*i)/10:Math.round(i);for(var d,p=0,o=!0;p<fmc.waypoints.route.length;p++)fmc.waypoints.route[p][1]||(o=!1);d=o?v(fmc.waypoints.route.length+1):fmc.math.getDistance(a,t,e,n);ges.aircraft.name;!ges.aircraft.groundContact&&W&&(s[0]=g(d,!0),s[1]=m(s[0][0],s[0][1]),s[4]=g(i,!1),d-k>0&&(s[2]=g(d-k,!1),s[3]=m(s[2][0],s[2][1]))),r(d,i,s)}function t(){var a=v(fmc.waypoints.nextWaypoint);a<=b(60)&&c(fmc.waypoints.nextWaypoint+1),clearInterval(A),A=a<ges.aircraft.animationValue.kias/60?setInterval(t,500):setInterval(t,3e4)}function e(){var a,t,e,n,s=fmc.waypoints.route,i=o(),d=l(),r=-1!==d,c=ges.aircraft.animationValue.altitude;r&&(a=s[d-1][3],t=a-c,e=v(d),n=x(t));var u,h,f,g=$("#tSpd").hasClass("btn-warning");if(g&&(u=i[0]),"climb"==D)if(r){var m=x(M-c)+x(a-M);m>e?(h=n>e?fmc.math.getClimbrate(t,e):i[1],f=a):(h=i[1],f=M)}else h=i[1],f=M;else"descent"==D&&(r?n>e&&(h=fmc.math.getClimbrate(t,e),f=a):(h=i[1],c>12e3+R&&(f=100*Math.round((12e3+R)/100))));"cruise"!==D||!F&&k||(r?(k=v(s.length)-e,k+=x(a-M)):k=x(R-M),k=Math.round(k),$("#todInput").val(""+k).change()),u&&$("#Qantas94Heavy-ap-spd > input").val(""+u).change(),h&&$("#Qantas94Heavy-ap-vs > input").val(""+h).change(),f&&$("#Qantas94Heavy-ap-alt > input").val(""+f).change(),p()}function n(a){if(!ges.pause&&!flight.recorder.playing&&!flight.recorder.paused){var t=Math.round(ges.aircraft.animationValue.ktas),e=Math.round(ges.aircraft.animationValue.heading360),s=Math.round(ges.aircraft.animationValue.altitude),i=ges.debug.fps,d=Math.round(1e4*ges.aircraft.llaLocation[0])/1e4,p=Math.round(1e4*ges.aircraft.llaLocation[1])/1e4,r=new Date,o=r.getUTCHours(),c=r.getUTCMinutes(),l=u(f(o,c));a=a||"none",$("<tr>").addClass("data").append($("<td>"+l+"</td>").css("padding","0px 10px 0px 10px"),$("<td>"+t+"</td>").css("padding","0px 10px 0px 10px"),$("<td>"+e+"</td>").css("padding","0px 10px 0px 10px"),$("<td>"+s+"</td>").css("padding","0px 10px 0px 10px"),$("<td>"+d+"</td>").css("padding","0px 10px 0px 10px"),$("<td>"+p+"</td>").css("padding","0px 10px 0px 10px"),$("<td>"+i+"</td>").css("padding","0px 10px 0px 10px"),$("<td>"+a+"</td>").css("padding","0px 10px 0px 10px")).appendTo("#logData")}clearInterval(S),S=ges.aircraft.animationValue.altitude>18e3?setInterval(n,12e4):setInterval(n,3e4)}function s(){ges.aircraft.animationValue.gearPosition!==ges.aircraft.animationValue.gearTarget&&n(1===ges.aircraft.animationValue.gearTarget?"Gear Up":"Gear Down"),clearInterval(V),V=ges.aircraft.animationValue.altitude<1e4?setInterval(s,12e3):setInterval(s,6e4)}function i(){ges.aircraft.animationValue.flapsPosition!==ges.aircraft.animationValue.flapsTarget&&n("Flaps set to "+ges.aircraft.animationValue.flapsTarget)}function d(){var a=ges.aircraft.animationValue.kcas,t=ges.aircraft.animationValue.altitude;a>255&&1e4>t&&n("Overspeed"),clearInterval(N),N=1e4>t?setInterval(d,15e3):setInterval(d,3e4)}function p(){var a=100*Math.round(ges.aircraft.animationValue.altitude/100);if("climb"===D&&a===Number(M))$("#phaseBtn").click();else if("cruise"===D){var t=v(fmc.waypoints.route.length+1);a!==Number(M)?$("#phaseBtn").click():k>=t&&$("#phaseBtn").click()}}function r(a,t,e){for(var n=0;n<e.length;n++)e[n]=u(e[n]);a=10>a?Math.round(10*a)/10:Math.round(a),$("#flightete").text("ETE: "+e[0]),$("#flighteta").text("ETA: "+e[1]),$("#todete").text("ETE: "+e[2]),$("#todeta").text("ETA: "+e[3]),$("#flightdist").text(a+" nm"),$("#externaldist").text(a+" nm"),$("#toddist").text(a-k+" nm"),$("#nextDist").text(t+" nm"),$("#nextETE").text(e[4])}function o(){var a,t,e=ges.aircraft.name,n=ges.groundElevation*metersToFeet,s=ges.aircraft.animationValue.altitude,i="M."===$("#Qantas94Heavy-ap-spd span:last-child").text().trim(),d=function(){$("#Qantas94Heavy-ap-spd span:last-child").click()};if("climb"==D){if(s>1500+n&&4e3+n>=s)switch(i&&d(),e){case"a380":case"md11":case"concorde":case"156":case"161":case"162":case"164":case"166":case"167":case"172":case"183":case"187":case"200":case"207":case"211":case"212":case"213":a=210,t=3e3}else if(s>4e3+n&&1e4+n>=s)switch(i&&d(),e){case"a380":case"md11":case"concorde":case"156":case"161":case"162":case"164":case"166":case"167":case"172":case"183":case"187":case"200":case"207":case"211":case"212":case"213":a=245,t=2500}else if(s>1e4+n&&18e3>=s)switch(i&&d(),e){case"a380":case"md11":case"concorde":case"156":case"161":case"167":case"172":case"183":case"187":case"207":case"211":case"212":case"213":a=295,t=2200;break;case"162":case"164":case"166":case"200":a=290,t=2200}else if(s>18e3&&24e3>=s)switch(i&&d(),e){case"concorde":case"a380":case"156":case"161":case"167":case"172":case"183":case"207":case"211":case"212":case"213":a=310,t=1800;break;case"md11":case"187":a=300,t=1800;break;case"162":case"164":case"166":case"200":a=295,t=1800}else if(s>24e3&&26e3>=s)switch(i&&d(),e){case"a380":case"156":case"161":case"167":case"172":case"207":case"211":case"212":case"213":t=1500}else if(s>26e3&&28e3>=s)switch(i&&d(),e){case"md11":case"162":case"164":case"166":case"183":case"187":case"200":t=1500}else if(s>29500)switch(i||d(),e){case"162":case"164":case"166":case"200":a=.76;break;case"a380":case"156":case"161":case"167":case"172":case"207":case"211":case"212":case"213":a=.82;break;case"md11":case"187":a=.78,t=1200;break;case"183":a=.8}if(s>M-100&&M>18e3)switch(i||d(),e){case"162":case"164":a=.785;break;case"166":case"200":a=.78;break;case"161":case"172":a=.84;break;case"a380":case"156":case"167":case"207":case"211":case"212":case"213":a=.85;break;case"md11":case"187":a=.8;break;case"183":a=.82;break;case"concorde":a=2}}else if("descent"==D)if(s>M-700&&M>=31e3)i||d(),t=-1e3;else if(s>45e3)switch(i||d(),e){case"concorde":a=1.5,t=-2e3}else if(s>3e4&&45e3>=s)switch(i||d(),e){case"concorde":t=-3600;break;case"a380":case"156":case"161":case"167":case"172":case"207":case"211":case"212":case"213":a=.83,t=-2400;break;case"183":a=.81,t=-2300;break;case"md11":case"162":case"164":case"166":case"187":case"200":a=.77,t=-2300}else if(s>18e3&&3e4>s)switch(i&&d(),e){case"162":case"164":case"166":case"200":a=295,t=-2100;break;case"a380":case"md11":case"156":case"161":case"167":case"172":case"183":case"187":case"207":case"211":case"212":case"213":a=310,t=-2200;break;case"concorde":a=330,t=-2400}else if(s>12e3+R&&18e3>=s)switch(i&&d(),e){case"a380":case"md11":case"concorde":case"156":case"161":case"162":case"164":case"166":case"167":case"172":case"183":case"187":case"200":case"207":case"211":case"212":case"213":a=280,t=-1800}return[a,t]}function c(a){if(fmc.waypoints.nextWaypoint!=a)if(a<=fmc.waypoints.route.length){fmc.waypoints.nextWaypoint=a;var t=fmc.waypoints.route[fmc.waypoints.nextWaypoint-1];t[4]?$("#Qantas94Heavy-ap-icao > input").val(t[0]).change():($("#Qantas94Heavy-ap-gc-lat > input").val(t[1]).change(),$("#Qantas94Heavy-ap-gc-lon > input").val(t[2]).change()),$(".activate").removeClass("btn-warning"),$("#waypoints tr:nth-child("+(a+1)+") .btn").addClass("btn-warning")}else $("#Qantas94Heavy-ap-icao > input").val(W[0]).change(),$(".activate").removeClass("btn-warning");else $(".activate").removeClass("btn-warning"),fmc.waypoints.nextWaypoint=void 0,$("#Qantas94Heavy-ap-icao > input").val("").change()}function l(){for(var a=fmc.waypoints.nextWaypoint;a<=fmc.waypoints.route.length;a++)if(fmc.waypoints.route[a-1][3])return a;return-1}function u(a){return a[1]=h(a[1]),a[0]+":"+a[1]}function h(a){return 10>a&&(a="0"+a),a}function f(a,t){return t>=60&&(t-=60,a++),a>=24&&(a-=24),[a,t]}function g(a,t){var e=a/ges.aircraft.animationValue.ktas,n=parseInt(e),s=Math.round(60*(e-n));return t&&(s+=Math.round(ges.aircraft.animationValue.altitude/4e3)),f(n,s)}function m(a,t){var e=new Date,n=e.getHours(),s=e.getMinutes();return n+=a,s+=Number(t),f(n,s)}function v(a){var t,e=ges.aircraft.llaLocation||[0,0,0],n=fmc.waypoints.nextWaypoint||0,s=fmc.waypoints.route;if(0!==s.length&&fmc.waypoints.nextWaypoint){t=fmc.math.getDistance(e[0],e[1],s[n-1][1],s[n-1][2]);for(var i=n;a>i&&i<s.length;i++)t+=fmc.math.getDistance(s[i-1][1],s[i-1][2],s[i][1],s[i][2]);a>s.length&&(t+=fmc.math.getDistance(s[s.length-1][1],s[s.length-1][2],W[1],W[2]))}else t=fmc.math.getDistance(e[0],e[1],W[1],W[2]);return t}function x(a){var t;return t=0>a?a/-1e3*3.4:a/1e3*2.5}function b(a){var t=ges.aircraft.animationValue.kcas,e=.107917*Math.pow(Math.E,.0128693*t),n=fmc.math.toRadians(a);return e*Math.tan(n/2)+.2}function y(){I?(I=!1,$("#vnavButton").removeClass("btn btn-warning").addClass("btn"),clearInterval(T)):M?(I=!0,$("#vnavButton").removeClass("btn").addClass("btn btn-warning"),T=setInterval(e,5e3)):alert("Please enter a cruising altitude.")}function w(){$("#tSpd").hasClass("btn-warning")?($("#tSpd").removeClass("btn-warning").addClass("btn-default").text("OFF"),spdControl=!1):($("#tSpd").removeClass("btn-default").addClass("btn-warning").text("ON"),spdControl=!0)}function C(){$("#logData tr").remove(".data")}var k,M,I=!1,W=[],D="climb",F=!1,R=0;window.feetToNM=1/6076,window.nmToFeet=6076;var T,A=(setInterval(a,5e3),setInterval(t,5e3)),S=setInterval(n,12e4),V=setInterval(s,12e3),N=(setInterval(i,5e3),setInterval(d,15e3));fmc.math.getGroundSpeed=function(){var a=ges.aircraft.animationValue.ktas,t=60*ges.aircraft.animationValue.climbrate*feetToNM;return Math.sqrt(a*a-t*t)},fmc.math.getClimbrate=function(a,t){var e=fmc.math.getGroundSpeed(),n=100*Math.round(e*(a/(t*nmToFeet))*nmToFeet/60/100);return n},fmc.math.getDistance=function(a,t,e,n){var s=fmc.math,i=s.toRadians(e-a),d=s.toRadians(n-t);a=s.toRadians(a),e=s.toRadians(e);var p=Math.sin(i/2)*Math.sin(i/2)+Math.cos(a)*Math.cos(e)*Math.sin(d/2)*Math.sin(d/2),r=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p));return s.earthRadiusNM*r},fmc.math.getBearing=function(a,t,e,n){var s=fmc.math;a=s.toRadians(a),e=s.toRadians(e),t=s.toRadians(t),n=s.toRadians(n);var i=Math.sin(n-t)*Math.cos(e),d=Math.cos(a)*Math.sin(e)-Math.sin(a)*Math.cos(e)*Math.cos(n-t),p=s.toDegrees(Math.atan2(i,d));return p},fmc.waypoints.getCoords=function(a){return autopilot_pp.require("icaoairports")[a]?autopilot_pp.require("icaoairports")[a]:autopilot_pp.require("waypoints")[a]?autopilot_pp.require("waypoints")[a]:!1},fmc.waypoints.formatCoords=function(a){if(a.indexOf(" ")>-1){var t,e=a.split(" "),n=Number(e[0]),s=Number(e[1])/60;return t=0>n?n-s:n+s}return Number(a)},fmc.waypoints.toRoute=function(a){if(0!==a.indexOf('["')){var t,e=(a.indexOf("fpl="),!0),n=$("#wptDeparture")[0].checked,s=$("#wptArrival")[0].checked,i=$("#waypoints tbody tr").length-1,d=[];d=a.trim().toUpperCase().split(" ");for(var p=0;p<d.length;p++)(d[p].length>5||d[p].length<1||!/^\w+$/.test(d[p]))&&(e=!1);if(e){for(var p=0;i>p;p++)fmc.waypoints.removeWaypoint(1);if(fmc.waypoints.route=[],n){var r=d[0];$("#departureInput").val(r).change(),t=1}else t=0,$("#departureInput").val("").change();for(var p=0;p+t<d.length;p++){fmc.waypoints.addWaypoint();var r=d[p+t];$("#waypoints input.wpt:eq("+p+")").val(r).change()}if(s){var r=d[d.length-1];$("#arrivalInput").val(r).change()}}else alert("Invalid Waypoints Input")}else fmc.waypoints.loadFromSave(a)},fmc.waypoints.addWaypoint=function(){var a=fmc.waypoints;a.route.length++;a.route.length;a.route[a.route.length-1]=[],$("<tr>").addClass("waypoint").append($("<td>").append($("<div>").addClass("input-prepend input-append").append($("<input>").addClass("input-medium").addClass("wpt").css("width","75px").attr("type","text").attr("placeholder","Fix/Apt.").change(function(){var t=$(this).val(),e=a.getCoords(t),n=$(this).parents().eq(2).index()-1;e?($(this).parents().eq(2).children(".position").children("div").children(".lat").val(e[0]),$(this).parents().eq(2).children(".position").children("div").children(".lon").val(e[1]),a.route[n]=[t,e[0],e[1],void 0,!0]):(a.route[n][0]=t,a.route[n][4]=!1)}))),$("<td>").addClass("position").append($("<div>").addClass("input-prepend input-append").append($("<input>").addClass("input-medium lat").css("width","80px").attr({type:"text",tabindex:"-1"}).change(function(){var t=$(this).parents().eq(2).index()-1;a.route[t][1]=a.formatCoords($(this).val()),a.route[t][4]=!1}),$("<input>").addClass("input-medium lon").css("width","80px").attr({type:"text",tabindex:"-1"}).change(function(){var t=$(this).parents().eq(2).index()-1;a.route[t][2]=a.formatCoords($(this).val()),a.route[t][4]=!1}))),$("<td>").addClass("altitude").append($("<div>").addClass("input-prepend input-append").append($("<input>").addClass("input-medium alt").css("width","40px").attr({type:"text",tabindex:"-1",placeholder:"Ft."}).change(function(){var t=$(this).parents().eq(2).index()-1;a.route[t][3]=Number($(this).val())}))),$("<td>").append($("<div>").addClass("input-prepend input-append").append($("<button>").attr("type","button").addClass("btn btn-standard activate").text("Activate").click(function(){var a=$(this).parents().eq(2).index();c(a)}),$("<button>").attr("type","button").addClass("btn btn-info").append($("<i>").addClass("icon-arrow-up")).click(function(){var a=$(this).parents().eq(2);fmc.waypoints.shiftWaypoint(a,a.index(),"up")}),$("<button>").attr("type","button").addClass("btn btn-info").append($("<i>").addClass("icon-arrow-down")).click(function(){var a=$(this).parents().eq(2);fmc.waypoints.shiftWaypoint(a,a.index(),"down")}),$("<button>").attr("type","button").addClass("btn btn-danger").append($("<i>").addClass("icon-remove")).click(function(){var t=$(this).parents().eq(2).index();a.removeWaypoint(t)})))).appendTo("#waypoints")},fmc.waypoints.removeWaypoint=function(a){$("#waypoints tr:nth-child("+(a+1)+")").remove(),fmc.waypoints.route.splice(a-1,1),fmc.waypoints.nextWaypoint==a&&(fmc.waypoints.nextWaypoint=null)},fmc.waypoints.saveData=function(){if(fmc.waypoints.route.length<1||!fmc.waypoints.route[0][0])alert("There is no route to save");else{localStorage.removeItem("fmcWaypoints");var a=fmc.waypoints.toRouteString();localStorage.setItem("fmcWaypoints",a)}},fmc.waypoints.loadFromSave=function(a){a=a||localStorage.getItem("fmcWaypoints");var t=fmc.waypoints,e=JSON.parse(a);if(localStorage.removeItem("fmcWaypoints"),e){t.route=[];for(var n=e[3],s=$("#waypoints tbody tr").length-1,i=0;s>i;i++)t.removeWaypoint(1);n.forEach(function(a){a[3]&&null!=a[3]&&0!=a[3]||(a[3]=void 0)}),e[0]&&$("#departureInput").val(e[0]).change(),e[1]&&$("#arrivalInput").val(e[1]).change(),e[2]&&$("#flightNumInput").val(e[2]).change();for(var i=0;i<n.length;i++)t.addWaypoint(),$("#waypoints input.wpt:eq("+i+")").val(n[i][0]).change(),n[i][4]&&$("#waypoints input.lat:eq("+i+")").val()||($("#waypoints input.lat:eq("+i+")").val(n[i][1]).change(),$("#waypoints input.lon:eq("+i+")").val(n[i][2]).change()),n[i][3]&&$("#waypoints input.alt:eq("+i+")").val(n[i][3]).change();t.saveData()}else alert("You did not save the waypoints or you cleared the browser's cache")},fmc.waypoints.shiftWaypoint=function(a,t,e){var n=fmc.waypoints;"up"==e&&1==t||"down"==e&&t==n.route.length||("up"==e?(n.route.move(t-1,t-2),a.insertBefore(a.prev()),n.nextWaypoint==t?n.nextWaypoint=t-1:n.nextWaypoint==t-1&&(n.nextWaypoint=t+1)):(n.route.move(t-1,t),a.insertAfter(a.next()),n.nextWaypoint==t?n.nextWaypoint=t+1:n.nextWaypoint==t+1&&(n.nextWaypoint=t-1)))},ges.resetFlight=function(){window.confirm("Reset Flight?")&&ges.lastFlightCoordinates&&(ges.flyTo(ges.lastFlightCoordinates,!0),n("Flight reset"))},ges.togglePause=function(){ges.pause?(ges.undoPause(),n("Flight resumed")):(n("Flight paused"),ges.doPause())},Array.prototype.move=function(a,t){if(t>=this.length)for(var e=t-this.length;e--+1;)this.push(void 0);return this.splice(t,0,this.splice(a,1)[0]),this},fmc.ui.modal=$("<div>").addClass("modal hide gefs-stopPropagation").attr("data-backdrop","static").attr("id","fmcModal").attr("tabindex","-1").attr("role","dialog").attr("aria-labelledby","fmcDialogBoxLabel").attr("aria-hidden","true").css("width","590px").append($("<div>").addClass("modal-dialog").append($("<div>").addClass("modal-content").append($("<div>").addClass("modal-header").append($("<button>").addClass("close").attr("type","button").attr("data-dismiss","modal").attr("aria-hidden","true").text("×"),$("<h3>").addClass("modal-title").attr("id","myModalLabel").css("text-align","center").text("Flight Management Computer")),$("<div>").addClass("modal-body").append($("<ul>").addClass("nav nav-tabs").append($("<li>").addClass("active").append('<a href="#rte" data-toggle="tab">RTE</a>'),$("<li>").append('<a href="#arr" data-toggle="tab">DEP/ARR</a>'),$("<li>").append('<a href="#vnav" data-toggle="tab">VNAV</a>'),$("<li>").append('<a href="#prog" data-toggle="tab">PROG</a>'),$("<li>").append('<a href="#load" data-toggle="tab">LOAD</a>'),$("<li>").append('<a href="#log" data-toggle="tab">LOG</a>')),$("<div>").addClass("tab-content").css("padding","5px").append($("<div>").addClass("tab-pane active").attr("id","rte").append($("<table>").append($("<tr>").append($("<table>").append($("<tr>").append($("<td>").css("padding","5px").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("Departure"),$("<input>").addClass("input-mini").attr("id","departureInput").attr("type","text").attr("placeholder","ICAO"))),$("<td>").css("padding","5px").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("Arrival"),$("<input>").addClass("input-mini").attr("type","text").attr("id","arrivalInput").attr("placeholder","ICAO").change(function(){var a=$(this).val(),t=fmc.waypoints.getCoords(a);t?W=[a,t[0],t[1]]:(alert("Invalid Airport code"),$(this).val(""))}))),$("<td>").css("padding","5px").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("Flight #"),$("<input>").addClass("input-mini").attr("id","flightNumInput").css("width","80px").attr("type","text")))))),$("<tr>").append($("<table>").attr("id","waypoints").append($("<tr>").append($("<td>").append("<th>Waypoints</th>"),$("<td>").append("<th>Position</th>"),$("<td>").append("<th>Altitude</th>"),$("<td>").append("<th>Actions</th>")))),$("<tr>").append($("<div>").attr("id","waypointsAddDel").append($("<table>").append($("<tr>").append($("<td>").append($("<button>").addClass("btn btn-primary").attr("type","button").text("Add Waypoint ").append($("<i>").addClass("icon-plus")).click(function(){fmc.waypoints.addWaypoint()}).css("margin-right","3px")))))),$("<tr>").append($("<div>").attr("id","saveRoute").append($("<table>").append($("<tr>").append($("<td>").append($("<button>").addClass("btn btn-info").attr("type","button").text("Save Route ").append($("<i>").addClass("icon-file icon-white")).click(function(){fmc.waypoints.saveData()}).css("margin-right","3px"),$("<button>").addClass("btn btn-info").attr("type","button").text("Retrieve Route ").append($("<i>").addClass("icon-refresh icon-white")).click(function(){fmc.waypoints.loadFromSave()})))))))),$("<div>").addClass("tab-pane").attr("id","arr").append($("<table>").append($("<tr>").append($("<td>").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("TOD Dist."),$("<input>").attr("id","todInput").attr("type","number").attr("min","0").attr("placeholder","nm").css("width","38px").change(function(){k=$(this).val()}))),$("<td>").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("Automatically calculate TOD"),$("<button>").addClass("btn btn-standard").attr("type","button").text("OFF").click(function(){F?($(this).removeClass("btn btn-warning").addClass("btn btn-standard").text("OFF"),F=!1):($(this).removeClass("btn btn-standard").addClass("btn btn-warning").text("ON"),F=!0)})))),$("<tr>").append($("<td>").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("Arrival Field Elev."),$("<input>").attr("type","number").attr("placeholder","ft.").css("width","55px").change(function(){R=Number($(this).val())})))))),$("<div>").addClass("tab-pane").attr("id","vnav").append($("<table>").append($("<tr>").append($("<td>").append($("<div>").addClass("input-prepend input-append").append($("<button>").addClass("btn").attr("id","vnavButton").text("VNAV ").append($("<i>").addClass("icon icon-resize-vertical")).click(function(){y()}),$("<span>").addClass("add-on").text("Cruise Alt."),$("<input>").attr("type","number").attr("step","100").attr("min","0").attr("max","100000").attr("placeholder","ft").css("width","80px").change(function(){M=Number($(this).val())})))),$("<tr>").append($("<td>").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("Phase"),$("<button>").addClass("btn btn-info").attr("id","phaseBtn").text("Climb").css("height","30px").css("width","77px").click(function(){$("#phaseLock").hasClass("btn-default")&&("climb"==D?($(this).text("Cruise"),D="cruise"):"cruise"==D?($(this).text("Descent"),D="descent"):($(this).text("Climb"),D="climb"))}),$("<button>").addClass("btn btn-default").attr("id","phaseLock").append($('<i class="icon-lock"></i>')).click(function(){$(this).hasClass("btn-default")?$(this).removeClass("btn-default").addClass("btn-danger"):$(this).removeClass("btn-danger").addClass("btn-default")}))),$("<td>").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("SPD Control"),$("<button>").addClass("btn btn-warning").attr("id","tSpd").text("ON").css("width","60px").click(function(){w()})))))),$("<div>").addClass("tab-pane").attr("id","prog").append($("<table>").append($("<tr>").append($("<td>").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("Dest"),$("<span>").addClass("add-on").css("background-color","white").css("width","53px").append($("<div>").attr("id","flightdist")),$("<span>").addClass("add-on").css("background-color","white").css("width","50px").append($("<table>").css({position:"relative",top:"-6px"}).append($("<tr>").append($("<td>").append($("<div>").attr("id","flightete").css("font-size","70%").css("height","10px"))),$("<tr>").append($("<td>").append($("<div>").attr("id","flighteta").css("font-size","70%").css("height","10px"))))))),$("<td>").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("TOD"),$("<span>").addClass("add-on").css("background-color","white").css("width","53px").append($("<div>").attr("id","toddist")),$("<span>").addClass("add-on").css("background-color","white").css("width","50px").append($("<table>").css({position:"relative",top:"-6px"}).append($("<tr>").append($("<td>").append($("<div>").attr("id","todete").css("font-size","70%").css("height","10px"))),$("<tr>").append($("<td>").append($("<div>").attr("id","todeta").css("font-size","70%").css("height","10px")))))))),$("<tr>").append($("<td>").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("Next Waypoint ").append($("<i>").addClass("icon-map-marker")),$("<span>").addClass("add-on").css("background-color","white").css("width","53px").append($("<div>").attr("id","nextDist")),$("<span>").addClass("add-on").css("background-color","white").css("width","53px").append($("<div>").attr("id","nextETE"))))))),$("<div>").addClass("tab-pane").attr("id","load").append($("<th>Enter waypoints seperated by spaces or a generated route</th>"),$("<form>").attr("action","javascript:fmc.waypoints.toRoute(fmc.waypoints.input);").addClass("form-horizontal").append($("<fieldset>").append($("<div>").addClass("input-prepend input-append").append($("<span>").addClass("add-on").text("Waypoints ").append($("<i>").addClass("icon-pencil")),$("<input>").attr("type","text").addClass("input-xlarge gefs-stopPropagation").change(function(){fmc.waypoints.input=$(this).val()})),$('<label class = "checkbox"><input type="checkbox" id="wptDeparture" value="true" checked> First waypoint is departure airport</label>'),$('<label class = "checkbox"><input type="checkbox" id="wptArrival" value="true" checked> Last waypoint is arrival airport</label>'),$("<button>").attr("type","submit").addClass("btn btn-primary").text("Load Route ").append($("<i>").addClass("icon-play"))),$("<fieldset>").css("margin-top","10px").append($("<button>").addClass("btn btn-warning").attr("type","button").text("Generate").click(function(){$("#generateRoute").val(fmc.waypoints.toRouteString()).change()}),$("<button>").addClass("btn btn-warning").attr("type","button").css("margin-left","5px").text("Clear").click(function(){$("#generateRoute").val("").change()}),$("<div>").css("margin-top","10px").append($("<textarea>").attr("id","generateRoute").attr("placeholder","Generate route. Save it or share it").css("margin","0px 0px 10px").css("width","350px").css("height","65px").css("resize","none"))))),$("<div>").addClass("tab-pane").attr("id","log").append($("<table>").attr("id","logData").append($("<tr>").append($("<th>Time</th>").css("padding","0px 10px 0px 10px"),$("<th>Speed</th>").css("padding","0px 10px 0px 10px"),$("<th>Heading</th>").css("padding","0px 10px 0px 10px"),$("<th>Altitude</th>").css("padding","0px 10px 0px 10px"),$("<th>Lat.</th>").css("padding","0px 10px 0px 10px"),$("<th>Lon.</th>").css("padding","0px 10px 0px 10px"),$("<th>FPS</th>").css("padding","0px 10px 0px 10px"),$("<th>Other</th>").css("padding","0px 10px 0px 10px"))),$("<button>").addClass("btn btn-danger").attr("type","button").click(function(){C()}).text("Clear Log ").append($("<i>").addClass("icon-remove-circle"))))),$("<div>").addClass("modal-footer").append($("<button>").addClass("btn btn-default").attr("type","button").attr("data-dismiss","modal").text("Close"),$("<button>").addClass("btn btn-primary").attr("type","button").text("Save changes ").append($("<i>").addClass("icon-hdd"))))),$('<iframe frame-border="no" class="gefs-shim-iframe"></iframe>')).appendTo("body"),fmc.waypoints.addWaypoint(),$("#fmcModal").modal({backdrop:!1,show:!1}),$("#fmcModal").keyup(function(a){a.stopImmediatePropagation()})});